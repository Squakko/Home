


























































public static string connectionString = "server=MINH_LIEN\\SQLEXPRESS; Database=QLBanHang; Integrated security=true;";

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Data.SqlClient;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

Thêm sql

public int ThemKhachHang(string hoTen, string soDienThoai, string diaChi)
        {
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);

            var command = conn.CreateCommand();
            command.CommandText = $"INSERT INTO KhachHang VALUES(@TenKH, @SoDienThoai, @DiaChiGH)";
            //do mã khách hàng tự tăng nên không cần ghi mã 

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();


            //Thêm giá trị cho tham số
            command.Parameters.AddWithValue("TenKH", hoTen);
            command.Parameters.AddWithValue("SoDienThoai", soDienThoai);
            command.Parameters.AddWithValue("DiaChiGH", diaChi);

            conn.Open();

            var soDongAnhHuong = command.ExecuteNonQuery();

            conn.Close();
            conn.Dispose();


            //dgvDSKH.DataSource = table;
            return soDongAnhHuong;
        }



	Sửa sql
public int SuaKhachHang(string maKH, string hoTen, string soDienThoai, string diaChi)
        {
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);

            var command = conn.CreateCommand();
            command.CommandText = $"UPDATE KhachHang SET TenKH = @TenKH, SoDienThoai = @SoDienThoai, DiaChiGH = @DiaChiGH WHERE MaKH = @MaKH";
            //do mã khách hàng tự tăng nên không cần ghi mã 

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();

            //Thêm giá trị cho tham số
            command.Parameters.AddWithValue("MaKH", maKH);
            command.Parameters.AddWithValue("TenKH", hoTen);
            command.Parameters.AddWithValue("SoDienThoai", soDienThoai);
            command.Parameters.AddWithValue("DiaChiGH", diaChi);

            conn.Open();

            var soDongAnhHuong = command.ExecuteNonQuery();

            conn.Close();
            conn.Dispose();


            //dgvDSKH.DataSource = table;
            return soDongAnhHuong;
        }



Tìm Kiếm Textchange


private void txtTimKiem_TextChanged(object sender, EventArgs e)
        {
            if (radioButton1.Checked)
            {
                string find = txtTimKiem.Text;
                var connString = Utilities.connectionString;
                var conn = new SqlConnection(connString);

                var command = conn.CreateCommand();
                command.CommandText = $"SELECT * FROM KhachHang WHERE TenKH like '%{find}%'";

                var adapter = new SqlDataAdapter(command);
                var table = new DataTable();


                conn.Open();

                adapter.Fill(table);

                conn.Close();
                conn.Dispose();


                dgvDSKH.DataSource = table;
            } else
            {
                string find = txtTimKiem.Text;
                var connString = Utilities.connectionString;
                var conn = new SqlConnection(connString);

                var command = conn.CreateCommand();
                command.CommandText = $"SELECT * FROM KhachHang WHERE SoDienThoai like '%{find}%'";

                var adapter = new SqlDataAdapter(command);
                var table = new DataTable();


                conn.Open();

                adapter.Fill(table);

                conn.Close();
                conn.Dispose();


                dgvDSKH.DataSource = table;
            }
        }



--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
form Khách Hàng: form2

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Data.SqlClient;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;


namespace QuanLyBanHang
{
    public partial class frmKhachHang : Form
    {
        public frmKhachHang()
        {
            InitializeComponent();
        }

        private void frmKhachHang_Load(object sender, EventArgs e)
        {
            LayDSKH();
        }

        public void LayDSKH ()
        {
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);

            var command = conn.CreateCommand();
            command.CommandText = $"SELECT * FROM KhachHang";

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();


            conn.Open();

            adapter.Fill(table);

            conn.Close();
            conn.Dispose();


            dgvDSKH.DataSource = table;
        }
            
        private void dgvDSKH_Click(object sender, EventArgs e)
        {
            if (dgvDSKH.SelectedRows.Count > 0)
            {
                var hangDangChon = dgvDSKH.SelectedRows[0]; //Hàng đang chọn

                txtMaKhachHang.Text = hangDangChon.Cells["MaKH"].Value.ToString();
                txtTenKhachHang.Text = hangDangChon.Cells["TenKH"].Value.ToString();
                txtSoDienThoai.Text = hangDangChon.Cells["SoDienThoai"].Value.ToString();
                txtDiaChiGiaoHang.Text = hangDangChon.Cells["DiaChiGH"].Value.ToString();
                //// Chỗ này phải đặt tên (thuộc tính Name trong cột giống như trong Cells["MaKH"] thì mới chạy không bị lỗi được)
                /// nếu không thì sẽ phải dùng index như thế này
                /// txtMaKhachHang.Text = hangDangChon.Cells[0].Value.ToString();
            }
        }

        private void btnMacDinh_Click(object sender, EventArgs e)
        {
            txtMaKhachHang.Clear();
            txtTenKhachHang.Clear();
            txtSoDienThoai.Clear();
            txtDiaChiGiaoHang.Clear();
        }

        private void btnLuu_Click(object sender, EventArgs e)
        {
            var ma = txtMaKhachHang.Text;
            var hoten = txtTenKhachHang.Text;
            var sdt = txtSoDienThoai.Text;
            var diachi = txtDiaChiGiaoHang.Text;
            var soDongAnhHuong = -1;

            if (string.IsNullOrEmpty(hoten) || string.IsNullOrEmpty(sdt))
            {
                MessageBox.Show("Vui lòng nhập họ tên và số điện thoại", "Thông báo");
                return;
            } 

            if (string.IsNullOrEmpty(ma))
            {
                soDongAnhHuong = ThemKhachHang(hoten, sdt, diachi);
            } else
            {
                soDongAnhHuong = SuaKhachHang(ma, hoten, sdt, diachi);
            }

            if (soDongAnhHuong > 0)
            {
                MessageBox.Show("Thêm/Sửa thành công", "Thông báo") ;
            }
            else
            {
                MessageBox.Show("Thêm/ Sửa không thành công", "Thông báo");
            }
        }

        public int ThemKhachHang(string hoTen, string soDienThoai, string diaChi)
        {
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);

            var command = conn.CreateCommand();
            command.CommandText = $"INSERT INTO KhachHang VALUES(@TenKH, @SoDienThoai, @DiaChiGH)";
            //do mã khách hàng tự tăng nên không cần ghi mã 

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();


            //Thêm giá trị cho tham số
            command.Parameters.AddWithValue("TenKH", hoTen);
            command.Parameters.AddWithValue("SoDienThoai", soDienThoai);
            command.Parameters.AddWithValue("DiaChiGH", diaChi);

            conn.Open();

            var soDongAnhHuong = command.ExecuteNonQuery();

            conn.Close();
            conn.Dispose();


            //dgvDSKH.DataSource = table;
            return soDongAnhHuong;
        }

        public int SuaKhachHang(string maKH, string hoTen, string soDienThoai, string diaChi)
        {
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);

            var command = conn.CreateCommand();
            command.CommandText = $"UPDATE KhachHang SET TenKH = @TenKH, SoDienThoai = @SoDienThoai, DiaChiGH = @DiaChiGH WHERE MaKH = @MaKH";
            //do mã khách hàng tự tăng nên không cần ghi mã 

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();

            //Thêm giá trị cho tham số
            command.Parameters.AddWithValue("MaKH", maKH);
            command.Parameters.AddWithValue("TenKH", hoTen);
            command.Parameters.AddWithValue("SoDienThoai", soDienThoai);
            command.Parameters.AddWithValue("DiaChiGH", diaChi);

            conn.Open();

            var soDongAnhHuong = command.ExecuteNonQuery();

            conn.Close();
            conn.Dispose();


            //dgvDSKH.DataSource = table;
            return soDongAnhHuong;
        }

        private void txtTimKiem_TextChanged(object sender, EventArgs e)
        {
            if (radioButton1.Checked)
            {
                string find = txtTimKiem.Text;
                var connString = Utilities.connectionString;
                var conn = new SqlConnection(connString);

                var command = conn.CreateCommand();
                command.CommandText = $"SELECT * FROM KhachHang WHERE TenKH like '%{find}%'";

                var adapter = new SqlDataAdapter(command);
                var table = new DataTable();


                conn.Open();

                adapter.Fill(table);

                conn.Close();
                conn.Dispose();


                dgvDSKH.DataSource = table;
            } else
            {
                string find = txtTimKiem.Text;
                var connString = Utilities.connectionString;
                var conn = new SqlConnection(connString);

                var command = conn.CreateCommand();
                command.CommandText = $"SELECT * FROM KhachHang WHERE SoDienThoai like '%{find}%'";

                var adapter = new SqlDataAdapter(command);
                var table = new DataTable();


                conn.Open();

                adapter.Fill(table);

                conn.Close();
                conn.Dispose();


                dgvDSKH.DataSource = table;
            }
        }
    }
}

//Chuyển datagrid view Prop Read Only = true
//                          Selection Mode = FullRowSelect


--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------

form Quản Lý Hàng Hóa: form1

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Data.SqlClient;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace QuanLyBanHang
{
    public partial class frmQuanLyHangHoa : Form
    {
        public frmQuanLyHangHoa()
        {
            InitializeComponent();
        }

        //Load tên nhóm loại vào combobox
        
        public void LayDanhSachLoaiMatHang()
        {
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);

            var command = conn.CreateCommand();
            command.CommandText = "SELECT * FROM LoaiMatHang";

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();


            conn.Open();

            adapter.Fill(table);

            conn.Close();
            conn.Dispose();

            cboLoaiHang.DisplayMember = "TenLoai";  //cái này để trước data table thì mới chạy
            cboLoaiHang.ValueMember = "MaLoai";     //
            cboLoaiHang.DataSource= table;
            
        }

        private void frmQuanLyHangHoa_Load(object sender, EventArgs e)
        {
            LayDanhSachLoaiMatHang();
        }

        public void LayDSMHTheoLoai(int maLoai)
        {
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);

            var command = conn.CreateCommand();
            command.CommandText = $"SELECT * FROM MatHang WHERE MaLoai = {maLoai}";

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();


            conn.Open();

            adapter.Fill(table);

            conn.Close();
            conn.Dispose();


            dgvDSHH.DataSource = table;

        }

        private void cboLoaiHang_SelectedIndexChanged(object sender, EventArgs e)
        {
            var maLoai = Convert.ToInt32(cboLoaiHang.SelectedValue);
            if (maLoai != null)
            {
                LayDSMHTheoLoai(maLoai);
            }
        }

        private void txtTimKiem_TextChanged(object sender, EventArgs e)
        {
            string find = txtTimKiem.Text;
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);
                //EXECUTE LỆNH SQL
            var command = conn.CreateCommand();
            command.CommandText = $"SELECT * FROM MatHang WHERE TenMatHang like '%{find}%'";   

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();


            conn.Open();

            adapter.Fill(table);

            conn.Close();
            conn.Dispose();


            dgvDSHH.DataSource = table;
        }

        private void button1_Click(object sender, EventArgs e)
        {
               frmKhachHang fkh = new frmKhachHang();
               fkh.ShowDialog();
        }

        private void label7_Click(object sender, EventArgs e)
        {

        }

        private void btnThem_Click(object sender, EventArgs e)
        {
            
        }



        public int ThemHangHoa(string tenHang, string donGia, string sl, string MaNCC, string maLoai)
        {
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);

            var command = conn.CreateCommand();
            command.CommandText = $"INSERT INTO MatHang VALUES(@TenMatHang, @SoLuong, @DonGia, @MaNCC, @MaLoai)";
            //do mã khách hàng tự tăng nên không cần ghi mã 

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();


            //Thêm giá trị cho tham số
            command.Parameters.AddWithValue("TenMatHang", tenHang);
            command.Parameters.AddWithValue("SoLuong", donGia);
            command.Parameters.AddWithValue("DonGia", sl);
            command.Parameters.AddWithValue("MaNCC", MaNCC);
            command.Parameters.AddWithValue("MaLoai", maLoai);

            conn.Open();

            var soDongAnhHuong = command.ExecuteNonQuery();

            conn.Close();
            conn.Dispose();


            //dgvDSKH.DataSource = table;
            return soDongAnhHuong;
        }

        public int SuaHangHoa(string maKH, string hoTen, string soDienThoai, string diaChi)
        {
            var connString = Utilities.connectionString;
            var conn = new SqlConnection(connString);

            var command = conn.CreateCommand();
            command.CommandText = $"UPDATE KhachHang SET TenKH = @TenKH, SoDienThoai = @SoDienThoai, DiaChiGH = @DiaChiGH WHERE MaKH = @MaKH";
            //do mã khách hàng tự tăng nên không cần ghi mã 

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();

            //Thêm giá trị cho tham số
            command.Parameters.AddWithValue("MaKH", maKH);
            command.Parameters.AddWithValue("TenKH", hoTen);
            command.Parameters.AddWithValue("SoDienThoai", soDienThoai);
            command.Parameters.AddWithValue("DiaChiGH", diaChi);

            conn.Open();

            var soDongAnhHuong = command.ExecuteNonQuery();

            conn.Close();
            conn.Dispose();


            //dgvDSKH.DataSource = table;
            return soDongAnhHuong;
        }
    }
}
-----------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------------
Class Khách Hàng
internal class KhachHang
    {
        public int MaKH { get; set; }
        public string TenKH { get; set; }
        public string SoDienThoai { get; set; }
        public string DiaChiGH { get; set; }

        // Hàm tạo lập từ 1 hàng của database
        public KhachHang(DataRow row)
        {
            MaKH = Convert.ToInt32(row["MaKH"]);
            TenKH = row["TenKH"].ToString();
            SoDienThoai = row["SoDienThoai"].ToString();
            DiaChiGH = row["DiaChiGH"].ToString();
        }
    }
Class Mặt hàng

internal class MatHang
    {
        public int MaMatHang { get; set; }
        public string TenMatHang  { get; set; }
        public int SoLuong  { get; set; }
        public int DonGia  { get; set; }
        public int MaNCC  { get; set; }
        public string TenNhaCC { get; set; }
        public int MaLoai  { get; set; }
        public string TenLoai  { get; set; }
        
        //Hàm tạo lập từ 1 hàng của database

        public MatHang (DataRow row)
        {
            MaMatHang = Convert.ToInt32(row["MaLoai"]);
            TenMatHang = row["TenMatHang"].ToString(); 
            SoLuong = Convert.ToInt32(row["SoLuong"]);
            DonGia = Convert.ToInt32(row["DonGia"]);
            MaNCC = Convert.ToInt32(row["MaNCC"]);
            TenNhaCC = row["TenNhaCC"].ToString();
            MaLoai = Convert.ToInt32(row["MaLoai"]);
            TenLoai = row["TenLoai"].ToString();
        }

    }


--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
SQL Lab 06:

/* Học phần: Cơ sở dữ liệu
   Người thực hiện: ????
   MSSV: ????
   Lớp: CTK45
   Ngày bắt đầu: 15/02/2023
   Ngày kết thúc: ?????
*/	
----------ĐỊNH NGHĨA CƠ SỞ DỮ LIỆU----------------
create database Lab06_QLHocVien
go
use Lab06_QLHocVien
go
create table CaHoc
(Ca			tinyint primary key,
GioBatDau	Datetime,
GioKetThuc	Datetime
)
go
create table GiaoVien
(MSGV		char(4) primary key,
HoGV		nvarchar(20),
TenGV		nvarchar(10),
DienThoai	varchar(11)
)
go
create table Lop
(MaLop	char(4) primary key,
TenLop	nvarchar(30),
NgayKG	Datetime,
HocPhi	int,
Ca		tinyint references CaHoc(Ca),
SoTiet	int,
SoHV	int,
MSGV	char(4) references GiaoVien(MSGV)
)
go
create table HocVien
(MSHV		char(6) primary key,
Ho			nvarchar(20),
Ten			nvarchar(10),
NgaySinh	Datetime,
Phai		nvarchar(4),
MaLop		char(4) references Lop(MaLop)
)
go
create table HocPhi
(
SoBL	char(6) primary key,
MSHV	char(6) references HocVien(MSHV),
NgayThu Datetime,
SoTien	int,
NoiDung	nvarchar(50),
NguoiThu nvarchar(30)
)
go
-------------------
select * from CaHoc
select * from GiaoVien
select * from Lop
select * from HocVien
select * from HocPhi
----------XÂY DỰNG CÁC THỦ TỤC NHẬP DỮ LIỆU (Câu 5a) -------------
CREATE PROC usp_ThemCaHoc
	@ca tinyint, @giobd Datetime, @giokt Datetime
As
	select * from CaHoc
	If exists(select * from CaHoc where Ca = @ca) --kiểm tra có trùng khóa chính (Ca) 
		print N'Đã có ca học ' +@ca+ N' trong CSDL!'
	Else
		begin
			insert into CaHoc values(@ca, @giobd, @giokt)
			print N'Thêm ca học thành công.'
		end
go
--goi thuc hien thu tuc usp_ThemCaHoc---
exec usp_ThemCaHoc 1,'7:30','10:45'
exec usp_ThemCaHoc 2,'13:30','16:45'
exec usp_ThemCaHoc 3,'17:30','20:45'
---------------------
CREATE PROC usp_ThemGiaoVien
	@msgv char(4), @hogv nvarchar(20), @Tengv nvarchar(10),@dienthoai varchar(11)
As
	select * from GiaoVien
	If exists(select * from GiaoVien where MSGV = @msgv) --kiểm tra có trùng khóa chính (MSGV) 
		print N'Đã có giáo viên có mã số ' +@msgv+ N' trong CSDL!'
	Else
		begin
			insert into GiaoVien values(@msgv, @hogv, @Tengv, @dienthoai)
			print N'Thêm giáo viên thành công.'
		end
go
--goi thuc hien thu tuc usp_ThemGiaoVien---
exec usp_ThemGiaoVien 'G001',N'Lê Hoàng',N'Anh', '858936'
exec usp_ThemGiaoVien 'G002',N'Nguyễn Ngọc',N'Lan', '845623'
exec usp_ThemGiaoVien 'G003',N'Trần Minh',N'Hùng', '823456'
exec usp_ThemGiaoVien 'G004',N'Võ Thanh',N'Trung', '841256'
---------------------
create PROC usp_ThemLopHoc
@malop char(4), @Tenlop nvarchar(20), 
@NgayKG datetime,@HocPhi int, @Ca tinyint, @sotiet int, @sohv int, 
@msgv char(4)
As
	select * from Lop
	If exists(select * from CaHoc where Ca = @Ca) and exists(select * from GiaoVien where MSGV=@msgv)--kiểm tra các RBTV khóa ngoại
	  Begin
		if exists(select * from Lop where MaLop = @malop) --kiểm tra có trùng khóa chính của quan hệ Lop 
			print N'Đã có lớp '+ @MaLop +' trong CSDL!'
else	
			begin
				insert into Lop values(@malop, @Tenlop, @NgayKG, @HocPhi, @Ca, @sotiet, @sohv, @msgv)
				print N'Thêm lớp học thành công.'
			end
	  End
	Else -- Bị vi phạm ràng buộc khóa ngoại
		if not exists(select * from CaHoc where Ca = @Ca)
				print N'Không có ca học '+@Ca+' trong CSDL.'
		else	print N'Không có giáo viên '+@msgv+' trong CSDL.'
go
--goi thuc hien thu tuc usp_ThemLopHoc---
set dateformat dmy
go
exec usp_ThemLopHoc 'A075',N'Access 2-4-6','18/12/2008', 150000,3,60,3,'G003'
exec usp_ThemLopHoc 'E114',N'Excel 3-5-7','02/01/2008', 120000,1,45,3,'G003'
exec usp_ThemLopHoc 'A115',N'Excel 2-4-6','22/01/2008', 120000,3,45,0,'G001'
exec usp_ThemLopHoc 'W123',N'Word 2-4-6','18/02/2008', 100000,3,30,1,'G001'
exec usp_ThemLopHoc 'W124',N'Word 3-5-7','01/03/2008', 100000,1,30,0,'G002'
----------------------
create PROC usp_ThemHocVien
@MSHV char(6), @Ho nvarchar(20), @Ten nvarchar(10),
@NgaySinh Datetime, @Phai	nvarchar(4),@MaLop char(4)
As
	select * from HocVien

	If exists(select * from Lop where MaLop = @MaLop) --kiểm tra có RBTV khóa ngoại
	  Begin
		if exists(select * from HocVien where MSHV = @MSHV) --kiểm tra có trùng khóa chính (MAHV) 
			print N'Đã có mã số học viên này trong CSDL!'
		else
			begin
				insert into HocVien values(@MSHV,@Ho, @Ten,@NgaySinh,@Phai,@MaLop)
				print N'Thêm học viên thành công.'
			end
	  End
	Else
		print N'Lớp '+ @MaLop + N' không tồn tại trong CSDL nên không thể thêm học viên vào lớp này!'
		
go
----goi thuc hien thu tuc usp_ThemHocVien-------
set dateformat dmy
go
exec usp_ThemHocVien 'A07501',N'Lê Văn', N'Minh', '10/06/1988',N'Nam', 'A075'
exec usp_ThemHocVien 'A07502',N'Nguyễn Thị', N'Mai', '20/04/1988',N'Nữ', 'A075'
exec usp_ThemHocVien 'A07503',N'Lê Ngọc', N'Tuấn', '10/06/1984',N'Nam', 'A075'
exec usp_ThemHocVien 'E11401',N'Vương Tuấn', N'Vũ', '25/03/1979',N'Nam', 'E114'
exec usp_ThemHocVien 'E11402',N'Lý Ngọc', N'Hân', '01/12/1985',N'Nữ', 'E114'
exec usp_ThemHocVien 'E11403',N'Trần Mai', N'Linh', '04/06/1980',N'Nữ', 'E114'
exec usp_ThemHocVien 'W12301',N'Nguyễn Ngọc', N'Tuyết', '12/05/1986',N'Nữ', 'W123'
----------------------------
create PROC usp_ThemHocPhi
@SoBL char(4),
@MSHV char(6),
@NgayThu Datetime,
@SoTien	int,
@NoiDung nvarchar(50),
@NguoiThu nvarchar(30)
As
	select * from HocPhi
	If exists(select * from HocVien where MSHV = @MSHV) --kiểm tra có RBTV khóa ngoại
	  Begin
		if exists(select * from HocPhi where SoBL = @SoBL) --kiểm tra có trùng khóa(SoBL) 
			print N'Đã có số biên lai học phí này trong CSDL!'
		else
		 begin
			insert into HocPhi values(@SoBL,@MSHV,@NgayThu, @SoTien, @NoiDung,@NguoiThu)
			print N'Thêm biên lai học phí thành công.'
		 end
	  End
	Else
		print N'Học viên '+ @MSHV + N' không tồn tại trong CSDL nên không thể thêm biên lai học phí của học viên này!'
go
----goi thuc hien thu tuc usp_ThemHocPhi-------
set dateformat dmy
go
exec usp_ThemHocPhi '0001','A07501','16/12/2008',150000,'HP Access 2-4-6', N'Lan'
exec usp_ThemHocPhi '0002','A07502','16/12/2008',100000,'HP Access 2-4-6', N'Lan'
exec usp_ThemHocPhi '0003','A07503','18/12/2008',150000,'HP Access 2-4-6', N'Vân'
exec usp_ThemHocPhi '0002','A07504','15/01/2009',50000,'HP Access 2-4-6', N'Vân'
exec usp_ThemHocPhi '0004','E11401','02/01/2008',120000,'HP Excel 3-5-7', N'Vân'
exec usp_ThemHocPhi '0005','E11402','02/01/2008',120000,'HP Excel 3-5-7', N'Vân'
exec usp_ThemHocPhi '0006','E11403','02/01/2008',80000,'HP Excel 3-5-7', N'Vân'
exec usp_ThemHocPhi '0007','W12301','18/02/2008',100000,'HP Word 2-4-6', N'Lan'

----------------------------
select * from CaHoc
select * from GiaoVien
select * from Lop
select * from HocVien
select * from HocPhi
------------------XÂY DỰNG CÁC THỦ TỤC SỬA DỮ LIỆU----------
create proc usp_suacahoc
@ca tinyint, @giobd Datetime, @giokt Datetime
as
 if exists(select * from CaHoc where CaHoc.Ca = @ca)
	begin 
		update CaHoc 
		set GioBatDau = @giobd, GioKetThuc= @giokt 
		where CaHoc.Ca = @ca
		print 'update thanh cong' 
	end 
else 
	print N'ca học không tồn tại' 
go
select * from CaHoc
exec usp_suacahoc 3, '17:35', '18:00'
alter proc usp_suagiaovien
@msgv char(4), @hogv nvarchar(20), @Tengv nvarchar(10),@dienthoai varchar(11)
as 
 if exists(select* from GiaoVien where GiaoVien.MSGV = @msgv) 
	begin 
	 update GiaoVien
	 set HoGV = @hogv, TenGV = @Tengv, DienThoai = @dienthoai
	 where MSGV = @msgv 
	 print ' update thanh cong' 
	end 
else 
	print N'update khong thanh cong'
go 
select * from GiaoVien
exec usp_suagiaovien 'G001',N'Lê Hoàng', N'Viet', '858936'

create proc usp_sualophoc
@malop char(4), @Tenlop nvarchar(20), 
@NgayKG datetime,@HocPhi int, @Ca tinyint, @sotiet int, @sohv int, 
@msgv char(4)
as 
 if exists(select* from Lop where Lop.MaLop = @malop) 
	begin 
	 update Lop
	 set TenLop = @Tenlop, NgayKG =@NgayKG, HocPhi = @HocPhi, Ca = @Ca, SoTiet = @sotiet, SoHV = @sohv, MSGV = @msgv
	 where MaLop = @malop 
	 print ' update thanh cong' 
	end 
else 
	print N'update khong thanh cong'
go 
select * from Lop 
exec usp_sualophoc 'A115',N'csgo 2-4-6','22/01/2008', 120000,3,45,0,'G003'


------------------XÂY DỰNG CÁC THỦ TỤC XÓA DỮ LIỆU----------
create proc usp_xoacahoc
@ca tinyint
as
 if exists(select * from CaHoc where CaHoc.Ca = @ca)
	begin 
		delete CaHoc 
		
		where CaHoc.Ca = @ca
		print 'xoa thanh cong' 
	end 
else 
	print N'ca học không tồn tại' 
go
exec usp_xoacahoc 1 
select * from CaHoc 

alter proc usp_xoagiaovien
@msgv char(4)
as 
 if exists(select* from GiaoVien where GiaoVien.MSGV = @msgv) 
	begin 
	 delete GiaoVien
	 
	 where MSGV = @msgv 
	 print ' xoa thanh cong' 
	end 
else 
	print N'xoa khong thanh cong'
go 
exec usp_xoagiaovien 'G002' 
select * from GiaoVien

create proc usp_xoalophoc
@malop char(4)
as 
 if exists(select* from Lop where Lop.MaLop = @malop) 
	begin 
	 delete Lop
	 
	 where MaLop = @malop 
	 print ' xoa thanh cong' 
	end 
else 
	print N'xoa khong thanh cong'
go 

exec usp_xoalophoc 'a115'
select * from Lop

-------------------------------------------------------------------------------
--------------------HÀM SINH MÃ & CÁCH SỬ DỤNG----------------
/*1. Viết hàm sinh mã cho giáo viên mới theo quy tắc lấy mã lớn nhất hiện có 
sau đó tăng thêm 1 đơn vị*/
create function SinhMaGV() returns char(4)
As
Begin
	declare @MaxMaGV char(4)
	declare @NewMaGV varchar(4)
	declare @stt	int
	declare @i	int	
	declare @sokyso	int

	if exists(select * from GiaoVien)---Nếu bảng giáo viên có dữ liệu
	 begin
		--Lấy mã giáo viên lớn nhất hiện có
		select @MaxMaGV = max(MSGV) 
		from GiaoVien
		--Trích phần ký số của mã lớn nhất và chuyển thành số 
		set @stt=convert(int, right(@MaxMaGV,3)) + 1 --Số thứ tự của giáo viên mới
	 end
	else--Nếu bảng giáo viên đang rỗng (nghĩa là chưa có giáo viên nào được lưu trữ trong CSDL.
	 set @stt= 1 -- Số thứ tự của giáo viên trong trường hợp chưa có gv nào trong CSDL
	
	--Kiểm tra và bổ sung chữ số 0 để đủ 3 ký số trong mã gv.
	set @sokyso = len(convert(varchar(3), @stt))
	set @NewMaGV='G'
	set @i = 0
	while @i < 3 -@sokyso
		begin
			set @NewMaGV = @NewMaGV + '0'
			set @i = @i + 1
		end	
	set @NewMaGV = @NewMaGV + convert(varchar(3), @stt)

return @NewMaGV	
End
--Thử hàm sinh mã
select * from GiaoVien
print dbo.SinhMaGV()
----2. Thủ  tục thêm giáo viên với mã giáo viên được sinh tự động----
CREATE PROC usp_ThemGiaoVien2
@hogv nvarchar(20), @tengv nvarchar(10), @dthoai varchar(10)
As
	declare @Magv char(4)
	
 if not exists(select * from GiaoVien 
				where HoGV = @hogv and TenGV = @tengv and DienThoai = @dthoai)
	Begin
		
		--sinh mã cho giáo viên mới
		set @Magv = dbo.SinhMaGV()
		insert into GiaoVien values(@Magv, @hogv, @tengv,@dthoai)
		print N'Đã thêm giáo viên thành công'
	End
else
	print N'Đã có giáo viên ' + @hogv +' ' + @tengv + ' trong CSDL'
Go
---Sử dụng thủ tục thêm giáo viên
exec usp_ThemGiaoVien2 N'Trần Ngọc Bảo', N'Hân', '0123456789'
exec usp_ThemGiaoVien2 N'Vũ Minh', N'Triết', '0123456788'
select * from GiaoVien




------------------CÀI ĐẶT RÀNG BUỘC TOÀN VẸN----------------
/*4a) Giờ kết thúc của một ca học không được trước giờ bắt đầu ca học đó 
(RBTV liên thuộc tính)*/
Create trigger tr_CaHoc_ins_upd_GioBD_GioKT
On CaHoc  for insert, update
As
if  update(GioBatDau) or update (GioKetThuc)
	     if exists(select * from inserted i where i.GioKetThuc<i.GioBatDau)	
	      begin
	    	 raiserror (N'Giờ kết thúc ca học không thể nhỏ hơn giờ bắt đầu',15,1)
		     rollback tran
	      end
go	
-----thử nghiệm hoạt động của trigger tr_CaHoc_ins_upd_GioBD_GioKT----
insert into CaHoc values(4,'17:00','15:30')
Update CaHoc set GioKetThuc = '5:45' where ca = 1

--select * from cahoc
/* 4b): Số học viên của 1 lớp không quá 30 và đúng bằng số học viên thuộc lớp đó. 
(RBTV do thuộc tính tổng hợp)*/
create trigger trg_Lop_ins_upd
on Lop for insert,update
AS
if Update(MaLop) or Update(SoHV)
Begin
	if exists(select * from inserted i where i.SOHV>30) 
	begin
		raiserror (N'Số học viên của một lớp không quá 30',15,1)--Thông báo lỗi cho người dùng
		rollback tran --hủy bỏ thao tác thêm lớp học
	end
	if exists (select * from inserted l 
	              where l.SOHV <> (select count(MSHV) 
									from HocVien 
									where HocVien.Malop = l.Malop))
	begin
		raiserror (N'Số học viên của một lớp không bằng số lượng học viên tại lớp đó',15,1)--Thông báo lỗi cho người dùng
		rollback tran --hủy bỏ thao tác thêm lớp học
	end
End
	
Go
-- Thử nghiệm 
select * from Lop
--
Set dateformat dmy
go
insert into Lop values('P001',N'Photoshop','1/11/2018',250000,1,100,0,'G004')
update Lop set SoHV = 5 where MaLop = 'P001'

/*4c)Tổng số tiền thu của một học viên không vượt quá học phí của lớp mà học viên đó đăng ký học*/
drop function fn_SoTienHocPhi_HocVien
create function fn_SoTienHocPhi_HocVien(@MSHV char(4)) returns int
as
	begin
		declare @HocPhi int
		set @HocPhi = (select HocPhi from HocVien h, Lop l where h.MaLop=l.MaLop and MSHV=@MSHV)
		return @HocPhi
	end
go

drop trigger tg_SoTienThu
create trigger tg_SoTienThu
on HocPhi for insert, update
as
if update(SoTien)
	if exists (select * from HocPhi group by MSHV having sum(SoTien)>dbo.fn_SoTienHocPhi_HocVien(MSHV))
		begin
			raiserror (N'Tổng số tiền thu của một học viên không vượt quá học phí của lớp mà học viên theo học',15,1)
			rollback tran
		end
go

/*5a): Hãy Cài đặt trigger cho bảng HocVien*/

/*5b): Thủ tục cập nhật thông tin một học viên */
drop proc ups_SuaHocVien
create proc ups_SuaHocVien
		@MSHV		char(4),
		@Ho			nvarchar(20),
		@Ten			nvarchar(10),
		@NgaySinh	Datetime,
		@Phai		nvarchar(4),
		@MaLop		char(4)
as
if exists (select * from HocVien where MSHV = @MSHV)
		begin
			update HocVien
			set Ho = @Ho, Ten = @Ten, NgaySinh = @NgaySinh, Phai = @Phai, MaLop = @MaLop
			where MSHV = @MSHV
			end
else 
		exec ups_ThemHocVien @MSHV, @Ho, @Ten, @NgaySinh, @Phai, @MaLop
go

/*5c): Thủ tục xóa một học viên */
drop proc ups_XoaHocVien
create proc ups_XoaHocVien
		@MSHV		char(4)
as
if exists (select * from HocVien where MSHV = @MSHV)
		begin
			delete from HocPhi
			where MSHV = @MSHV
			delete from HocVien
			where MSHV = @MSHV
		end
else
		print N'Không tìm thấy học viên này để xóa'
go
/*5d): Cập nhật thông tin của một lớp học cho trước */
create proc ups_CapNhat_LopHoc
		@MaLop	char(4),
		@TenLop	nvarchar(30),
		@NgayKG	Datetime,
		@HocPhi	int,
		@Ca		tinyint,
		@SoTiet	int,
		@SoHV	int,
		@MSGV	char(4)
as
if exists (select * from Lop where MaLop = @MaLop)
		begin
			update Lop
			set MaLop = @MaLop, TenLop = @TenLop, NgayKG = @NgayKG, HocPhi = @HocPhi, Ca = @Ca, SoTiet = @SoTiet, SoHV = @SoHV, MSGV = @MSGV
			where MaLop = @MaLop
		end
else
		print N'Không tìm thấy lớp này để cập nhật'
go
/*5e): Xóa một lớp học cho trước nếu lớp này không có học viên */
create proc ups_XoaLopHoc
		@MaLop char(4)
as
if exists (select * from Lop where MaLop = @MaLop)
		begin
			delete from Lop
			where MaLop = @MaLop
		end
else 
		print N'Không tìm thấy lớp như vậy hoặc lớp này đã có học viên'
go

/*5f): Lập danh sách học viên của một lớp học cho trước */
create proc ups_LapDSHocVien_TheoLop
		@MaLop char(4)
as
		select * from HocVien where MaLop = @MaLop
go

/*5g): Lập danh sách học viên chưa đóng đủ học phí của một lớp cho trước */
create proc ups_LapDSHocVien_ChuaDongDuHocPhi
		@MaLop char(4)
as
if exists (select * from HocVien where MaLop = @MaLop)
		begin
			select * from HocVien where MaLop = @MaLop
--6a) Hàm tính tổng số học phí đã thu được của một lớp khi biết mã lớp. 
create function fn_TongHocPhi1Lop(@malop char(4)) returns int
As
Begin
	declare @TongTien int
	if exists (select * from Lop where MaLop = @MaLop) ---Nếu tồn tại lớp @malop trong CSDL
		Begin
		--Tính tổng số học phí thu được trên 1 lớp
		select @TongTien = sum(SoTien)
		from	HocPhi A, HocVien B	
		where	A.MSHV = B.MSHV and B.Malop = @malop
		End	
	 	
return @TongTien
End
--- thử nghiệm hàm-------
print dbo.fn_TongHocPhi1Lop('A075')
--6b) Hàm tính tổng số học phí thu được trong một khoảng thời gian cho trước. 
create function fn_TongHocPhi(@bd datetime,@kt datetime) returns int
As
Begin
	declare @TongTien int
	--Tính tổng số học phí thu được trong khoảng thời gian từ bắt đầu đến kết thúc
	select @TongTien = sum(SoTien)
	from	HocPhi 	
	where	NgayThu between @bd and @kt
return @TongTien
End
--- thu nghiem ham-------
set dateformat dmy
print dbo.fn_TongHocPhi('1/1/2008','15/1/2008')
--6c) Cho biết một học viên cho trước đã nộp đủ học phí hay chưa. 
create function fn_KiemTraDongDuHocPhi (@MSHV char(4)) returns bit
as
	begin
		declare @result bit
		declare @soTien int
		set @soTien=(select sum(SoTien) from HocPhi where MSHV=@MSHV)
		if dbo.fn_SoTienHocPhi_HocVien(@MSHV)=@soTien
			set @result=1		--Đã đóng đủ
		else 
			set @result=0 		--Chưa đóng đủ
		return @result
	end
go
--6d) Hàm sinh mã số học viên theo quy tắc mã số học viên gồm mã lớp của học viên kết hợp với số thứ tự của học viên trong lớp đó. 
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------





Câu 5 đề tham khảo
combobox loại hàng 
hiển thị loại hàng


private void comboBox2_SelectedIndexChanged(object sender, EventArgs e)
        {
            int id;
            var result = int.TryParse((cboLoai.SelectedIndex + 1).ToString(), out id);

            string find = textBox1.Text;

            var conn = new SqlConnection(Utilities.connectionString);

            var command = conn.CreateCommand();
            command.CommandText = $"Select * from MatHang where MaLoai = '{id}'";

            var adapter = new SqlDataAdapter(command);
            var table = new DataTable();



            conn.Open();
            adapter.Fill(table);
            conn.Close();
            conn.Dispose();

            dgvMatHang.DataSource = table;
        }








=========================================================================================
	===== Lấy thông tin từ datagridview ra textbox
private void dgvMatHang_SelectionChanged(object sender, EventArgs e) ///Sự kiện chọn hàng trong grid view
        {
            if (dgvMatHang.SelectedRows.Count > 0)
            {
                DataGridViewRow selectedRow = dgvMatHang.SelectedRows[0];
                string ValuetenMH = selectedRow.Cells["TenMatHang"].Value.ToString();
            }
        }

 private void btn_LayThongTin_Click(object sender, EventArgs e) ///ấn nút để lấy
        {
            if (dgvMatHang.SelectedRows.Count > 0)
            {
                DataGridViewRow selectedRow = dgvMatHang.SelectedRows[0];
                txtTenMH.Text = selectedRow.Cells["TenMatHang"].Value.ToString();
                txtDonGia.Text = selectedRow.Cells["DonGia"].Value.ToString();
            }
        }

Truyền tham số giữa các form:

Trong Form1:

private void OpenForm2()
{
    string parameter = "Hello World";
    Form2 form2 = new Form2(parameter);
    form2.Show();
}

Trong Form2:

public partial class Form2 : Form
{
    private string parameter;

    public Form2(string parameter)
    {
        InitializeComponent();
        this.parameter = parameter;
    }
}


Cách 2: Sử dụng Property
Truyền tham số từ Form1 sang Form2 thông qua một property trên Form2. Dưới đây là ví dụ minh họa:

Trong Form1:


private void OpenForm2()
{
    string parameter = "Hello World";
    Form2 form2 = new Form2();
    form2.Parameter = parameter;
    form2.Show();
}
Trong Form2:


public partial class Form2 : Form
{
    public string Parameter { get; set; }

    public Form2()
    {
        InitializeComponent();
    }
}



Đóng Form2 để thực thi hàm trên form1: 

		Trong Form1:
private void OpenForm2()
        {
            Form2 frm2 = new Form2(this);
            frm2.Show();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            OpenForm2();
        }

        public void ShowMessage()
        {
            MessageBox.Show("Đã thay đổi");
        }


		Trong Form2:
public partial class Form2 : Form
    {
        private Form1 form1 = new Form1();
        public Form2(Form1 frm1)
        {
            InitializeComponent();
            form1 = frm1;
        }

        private void Form2_FormClosed(object sender, FormClosedEventArgs e)
        {
            form1.ShowMessage();
        }